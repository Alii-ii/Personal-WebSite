"use client";

import React, { useEffect } from "react";
import { useLanguage } from "@/contexts/LanguageContext";

// 语言切换组件
const LanguageToggle = () => {
  const { language, toggleLanguage, getLanguageDisplayName } = useLanguage();

  // 添加键盘快捷键监听
  useEffect(() => {
    const handleKeyDown = (event) => {
      // 检查是否按下了 Shift + L
      if (event.shiftKey && event.key === 'L') {
        event.preventDefault(); // 防止默认行为
        toggleLanguage();
      }
    };

    // 添加全局键盘事件监听器
    document.addEventListener('keydown', handleKeyDown);

    // 清理函数：组件卸载时移除事件监听器
    return () => {
      document.removeEventListener('keydown', handleKeyDown);
    };
  }, [toggleLanguage]); // 依赖toggleLanguage函数

  // 处理点击事件
  const handleClick = (event) => {
    toggleLanguage();
  };

  return (
    <div
      onClick={handleClick}
      className="flex flex-row justify-center items-center p-0.5 gap-[2px] size-fit rounded-[6px] cursor-pointer relative border border-[0.5px] border-stroke bg-press overflow-hidden"
      title={`当前: ${getLanguageDisplayName()} | 切换 (⇧ + L)`}
    >
      {/* Cn */}
      <div className="z-10 flex flex-row justify-center items-center p-1 size-fit rounded-[4px] hover:opacity-80 cursor-pointer">
        <svg
          className="w-4 h-4 flex-none order-0 text-secondary opacity-90"
          viewBox="0 0 16 16"
          fill="none"
        >
          <path
            d="M13.0106 5.04594C12.9683 4.85251 12.8866 4.69966 12.7673 4.59153C12.6507 4.48582 12.493 4.41657 12.2981 4.38571C12.1375 4.36068 11.9329 4.3478 11.6894 4.3478H8.66817V2.85384C8.66817 2.62007 8.60402 2.44365 8.4762 2.32871C8.35664 2.22204 8.18654 2.16785 7.97076 2.16785C7.73602 2.16785 7.56276 2.22058 7.4415 2.3292C7.31466 2.44292 7.25002 2.61934 7.25002 2.85384V4.3478H4.28736C4.03562 4.3478 3.83368 4.36481 3.67039 4.40005C3.48595 4.44038 3.3348 4.51255 3.22108 4.61486C3.09982 4.72494 3.01963 4.87754 2.9827 5.06878C2.95208 5.22527 2.9375 5.41554 2.9375 5.65125V9.34631C2.9375 9.57449 2.95232 9.7599 2.98294 9.9125C3.0189 10.0938 3.09302 10.244 3.20237 10.3589C3.31439 10.4765 3.47064 10.5572 3.66601 10.598C3.83028 10.6325 4.03367 10.6498 4.28761 10.6498H7.25026V13.1578C7.25026 13.3731 7.29498 13.5325 7.38732 13.6447C7.52583 13.8127 7.78 13.8321 7.95934 13.8321C8.21303 13.8321 8.39236 13.7689 8.50779 13.6401C8.61422 13.5201 8.66841 13.3621 8.66841 13.1697V10.6498H11.7011C11.9547 10.6498 12.1581 10.6328 12.3217 10.598C12.5156 10.5577 12.6723 10.4784 12.7877 10.3633C12.9032 10.2481 12.9804 10.0962 13.0174 9.91323C13.048 9.76014 13.0628 9.57449 13.0628 9.34655V5.66316C13.0623 5.41117 13.0453 5.20972 13.0106 5.04594ZM11.6678 5.72561V9.25276C11.6678 9.25762 11.6678 9.26223 11.6675 9.26661H8.66817V5.73047L11.6678 5.72561ZM7.25002 5.73096V9.26661H4.33232V5.73096H7.25002ZM4.28736 5.48796V5.72707C4.28542 5.72853 4.28323 5.72998 4.28129 5.73144L4.28736 5.48796Z" 
            fill="currentColor"
          />
        </svg>
      </div>

      {/* En */}
      <div className="z-10 flex flex-row justify-center items-center p-1 size-fit rounded-[4px] hover:opacity-80 cursor-pointer">
        <svg
          className="w-4 h-4 flex-none order-0 text-secondary opacity-90"
          viewBox="0 0 16 16"
          fill="none"
        >
          <path
            d="M6.62702 10.6678C6.53055 10.6416 6.42023 10.6262 6.29873 10.6216C6.19375 10.618 6.08392 10.6165 5.96825 10.6165H3.5261V8.51117H6.14734C6.36628 8.51117 6.52933 8.47108 6.645 8.38992C6.74439 8.32042 6.86322 8.17972 6.86322 7.90051C6.86322 7.67695 6.79469 7.5088 6.65983 7.40091C6.54051 7.30541 6.37309 7.25851 6.14734 7.25851H3.52634V5.39518H6.2528C6.45668 5.39518 6.61536 5.35412 6.73783 5.27028C6.84329 5.19884 6.96892 5.0545 6.96868 4.76047C6.95701 4.53739 6.87974 4.3724 6.7371 4.27009C6.61657 4.18431 6.45814 4.14252 6.2528 4.14252H2.91568C2.66126 4.14252 2.47804 4.19865 2.35508 4.31481C2.22945 4.4346 2.16821 4.61248 2.16821 4.85815V11.1533C2.16821 11.4233 2.24476 11.6165 2.39566 11.728C2.52396 11.823 2.69407 11.8694 2.91568 11.8694H6.31598C6.54391 11.8694 6.71377 11.832 6.83697 11.7543C6.94511 11.6855 7.0739 11.5394 7.0739 11.2376C7.0739 11.0386 6.99832 10.9159 6.93539 10.8486C6.85617 10.7628 6.75265 10.7021 6.62702 10.6678ZM13.6694 4.21809C13.5542 4.09052 13.3788 4.02588 13.1479 4.02588C12.9086 4.02588 12.7305 4.09926 12.6184 4.24434C12.5224 4.36827 12.4741 4.52136 12.4741 4.69972V9.27055L9.16175 4.42731C9.0925 4.34348 9.02373 4.26693 8.9552 4.19865C8.87647 4.11992 8.73504 4.02588 8.50541 4.02588C8.21697 4.02588 8.07068 4.15127 7.99876 4.25673C7.91565 4.37799 7.87385 4.52719 7.87385 4.69972V11.2901C7.87385 11.4716 7.9278 11.6289 8.03399 11.7574C8.11564 11.8561 8.27092 11.9744 8.54745 11.9744C8.82034 11.9744 8.97805 11.8592 9.06188 11.7625C9.17463 11.633 9.23174 11.4736 9.23174 11.2901V6.80434L12.5207 11.5448C12.598 11.6568 12.6843 11.7513 12.7781 11.8274C12.8998 11.9251 13.042 11.9744 13.2007 11.9744C13.4898 11.9744 13.6361 11.8485 13.7073 11.7436C13.7904 11.6223 13.8322 11.4731 13.8322 11.3006V4.69996C13.8322 4.50094 13.7778 4.33911 13.6694 4.21809Z" 
            fill="currentColor"
          />
        </svg>
      </div>

      {/* toggle */}
      <div
        className={`absolute top-0.5 size-6 rounded-[4px] transition-all z-0 duration-200 bg-card ${language === "zh" ? "left-0.5" : "left-[28px]"}`}
      ></div>
    </div>
  );
};

export default LanguageToggle;
